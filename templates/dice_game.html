<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>骰子游戏</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
  <div class="container py-5 text-center">
    <h1 class="mb-4">🎲 骰子对战游戏</h1>

    <div id="result" class="alert alert-secondary" style="display: none;"></div>

    <button id="playBtn" class="btn btn-primary btn-lg">开始游戏</button>

    <!-- ✅ 添加绑定 Telegram 按钮 -->
    <div class="mt-4">
      <a href="https://t.me/mingameh5_bot?start={{ telegram_id }}" target="_blank" class="btn btn-primary">
  📱 点击绑定 Telegram 账号
      </a>
    </div>
  </div>

  <script>
    const btn = document.getElementById("playBtn");
    const result = document.getElementById("result");

    btn.onclick = async () => {
      result.style.display = "none";
      const url = new URL(window.location.href);
      const user_id = url.searchParams.get("user_id");
      if (!user_id) return alert("❌ 缺少 user_id");

      btn.disabled = true;
      btn.innerText = "游戏中…";

      const res = await fetch(`/api/play_game?user_id=${user_id}`);
      const data = await res.json();

      btn.disabled = false;
      btn.innerText = "开始游戏";

      if (data.error) {
        result.className = "alert alert-danger";
        result.innerText = data.error;
      } else {
        result.className = "alert alert-success";
        result.innerText = `${data.message} 🎯 当前积分：${data.total_points}`;
      }

      result.style.display = "block";
    };
  </script>
</body>
</html>
